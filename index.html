<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo 30S - Prediction System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .prediction-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .countdown {
            text-align: center;
            margin-bottom: 30px;
        }

        .countdown-timer {
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .countdown-label {
            font-size: 1.2em;
            color: #666;
            margin-top: 10px;
        }

        .prediction-section {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .prediction-label {
            color: white;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .prediction-value {
            font-size: 5em;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }

        .prediction-details {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

        .detail-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
            color: white;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
        }

        .stat-card.win {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.loss {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .history-table {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .history-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        th {
            padding: 15px;
            text-align: center;
            color: white;
            font-weight: 600;
        }

        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .number-display {
            font-size: 1.8em;
            font-weight: bold;
        }

        .color-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 3px;
            vertical-align: middle;
        }

        .color-red {
            background: #ff4757;
        }

        .color-green {
            background: #2ed573;
        }

        .color-purple {
            background: #a55eea;
        }

        .result-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
        }

        .result-win {
            background: #2ed573;
        }

        .result-loss {
            background: #ff4757;
        }

        .result-pending {
            background: #ffa502;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        .last-period {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .last-period-label {
            color: #666;
            margin-bottom: 10px;
        }

        .last-period-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ WinGo 30S</h1>
            <p>Prediction System with Live Results</p>
        </div>

        <div class="prediction-card">
            <div class="countdown">
                <div class="countdown-timer" id="countdown">30</div>
                <div class="countdown-label">‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ï‡¶ø</div>
            </div>

            <div class="last-period">
                <div class="last-period-label">‡¶∂‡ßá‡¶∑ ‡¶™‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶°</div>
                <div class="last-period-value" id="lastPeriod">Loading...</div>
            </div>

            <div class="prediction-section">
                <div class="prediction-label">üìä ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ï‡¶∂‡¶®</div>
                <div class="prediction-value pulse" id="predictionNumber">-</div>
                <div class="prediction-details">
                    <div class="detail-item" id="predictionSize">-</div>
                    <div class="detail-item" id="predictionColors">-</div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalPredictions">0</div>
                    <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ï‡¶∂‡¶®</div>
                </div>
                <div class="stat-card win">
                    <div class="stat-value" id="totalWins">0</div>
                    <div class="stat-label">‡¶ú‡¶Ø‡¶º</div>
                </div>
                <div class="stat-card loss">
                    <div class="stat-value" id="totalLosses">0</div>
                    <div class="stat-label">‡¶π‡¶æ‡¶∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">‡¶∏‡¶æ‡¶´‡¶≤‡ßç‡¶Ø‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞</div>
                </div>
            </div>
        </div>

        <div class="history-table">
            <h2 class="history-title">üìú ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü</h2>
            <table>
                <thead>
                    <tr>
                        <th>‡¶™‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶°</th>
                        <th>‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</th>
                        <th>‡¶∏‡¶æ‡¶á‡¶ú</th>
                        <th>‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞</th>
                        <th>‡¶™‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ï‡¶∂‡¶®</th>
                        <th>‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <tr>
                        <td colspan="6" class="loading">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let countdown = 30;
        let currentPrediction = null;
        let predictions = [];
        let gameHistory = [];
        let stats = {
            total: 0,
            wins: 0,
            losses: 0
        };

        const API_URL = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://draw.ar-lottery01.com/WinGo/WinGo_30S/GetHistoryIssuePage.json');

        // Number properties
        const numberProperties = {
            0: { size: 'Small', colors: ['red', 'purple'] },
            1: { size: 'Small', colors: ['green'] },
            2: { size: 'Small', colors: ['red'] },
            3: { size: 'Small', colors: ['green'] },
            4: { size: 'Small', colors: ['red'] },
            5: { size: 'Big', colors: ['green', 'purple'] },
            6: { size: 'Big', colors: ['red'] },
            7: { size: 'Big', colors: ['green'] },
            8: { size: 'Big', colors: ['red'] },
            9: { size: 'Big', colors: ['green'] }
        };

        // Generate random prediction
        function generatePrediction() {
            const number = Math.floor(Math.random() * 10);
            const properties = numberProperties[number];
            
            currentPrediction = {
                number: number,
                size: properties.size,
                colors: properties.colors,
                timestamp: Date.now()
            };

            updatePredictionDisplay();
        }

        function updatePredictionDisplay() {
            if (!currentPrediction) return;

            document.getElementById('predictionNumber').textContent = currentPrediction.number;
            document.getElementById('predictionSize').textContent = currentPrediction.size;
            
            const colorsText = currentPrediction.colors.map(c => {
                if (c === 'red') return 'üî¥ ‡¶≤‡¶æ‡¶≤';
                if (c === 'green') return 'üü¢ ‡¶∏‡¶¨‡ßÅ‡¶ú';
                if (c === 'purple') return 'üü£ ‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø';
            }).join(' ');
            
            document.getElementById('predictionColors').textContent = colorsText;
        }

        // Fetch game history from API
        async function fetchGameHistory() {
            try {
                // Try primary proxy
                let response = await fetch(API_URL);
                let data = await response.json();
                
                if (data && data.data && data.data.list) {
                    gameHistory = data.data.list;
                    updateHistoryTable();
                    updateLastPeriod();
                    checkPreviousPrediction();
                    console.log('Data loaded successfully:', gameHistory.length, 'items');
                    return;
                }
                
                // If first method fails, try direct fetch
                response = await fetch('https://draw.ar-lottery01.com/WinGo/WinGo_30S/GetHistoryIssuePage.json', {
                    mode: 'cors'
                });
                data = await response.json();
                
                if (data && data.data && data.data.list) {
                    gameHistory = data.data.list;
                    updateHistoryTable();
                    updateLastPeriod();
                    checkPreviousPrediction();
                    console.log('Data loaded successfully:', gameHistory.length, 'items');
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                // Use demo data if API fails
                useDemoData();
            }
        }

        // Demo data for testing
        function useDemoData() {
            const now = Date.now();
            const baseNumber = 202601301000051385;
            
            gameHistory = [];
            for (let i = 0; i < 20; i++) {
                const number = Math.floor(Math.random() * 10);
                const period = String(baseNumber - i);
                gameHistory.push({
                    period: period,
                    number: number,
                    bigSmall: numberProperties[number].size,
                    color: numberProperties[number].colors
                });
            }
            
            console.log('Using demo data');
            updateHistoryTable();
            updateLastPeriod();
        }

        function updateLastPeriod() {
            if (gameHistory.length > 0) {
                const lastGame = gameHistory[0];
                document.getElementById('lastPeriod').textContent = lastGame.period;
            }
        }

        function checkPreviousPrediction() {
            if (predictions.length === 0 || !gameHistory.length) return;

            const lastPrediction = predictions[predictions.length - 1];
            if (lastPrediction.result !== 'pending') return;

            const lastGame = gameHistory[0];
            const actualNumber = lastGame.number;

            if (lastPrediction.number === actualNumber) {
                lastPrediction.result = 'win';
                stats.wins++;
            } else {
                lastPrediction.result = 'loss';
                stats.losses++;
            }

            stats.total++;
            updateStats();
            updateHistoryTable();
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';

            const displayHistory = gameHistory.slice(0, 10);

            displayHistory.forEach((game, index) => {
                const prediction = predictions.find(p => p.period === game.period);
                
                const tr = document.createElement('tr');
                
                // Period
                const tdPeriod = document.createElement('td');
                tdPeriod.textContent = game.period.slice(-6);
                tr.appendChild(tdPeriod);

                // Number
                const tdNumber = document.createElement('td');
                tdNumber.innerHTML = `<span class="number-display">${game.number}</span>`;
                tdNumber.style.color = getNumberColor(game.number);
                tr.appendChild(tdNumber);

                // Size
                const tdSize = document.createElement('td');
                tdSize.textContent = game.bigSmall === 'Big' ? '‡¶¨‡¶°‡¶º' : '‡¶õ‡ßã‡¶ü';
                tr.appendChild(tdSize);

                // Colors
                const tdColor = document.createElement('td');
                const colors = getColorsForNumber(game.number);
                colors.forEach(color => {
                    const span = document.createElement('span');
                    span.className = `color-indicator color-${color}`;
                    tdColor.appendChild(span);
                });
                tr.appendChild(tdColor);

                // Prediction
                const tdPrediction = document.createElement('td');
                if (prediction) {
                    tdPrediction.innerHTML = `<span class="number-display">${prediction.number}</span>`;
                    tdPrediction.style.color = getNumberColor(prediction.number);
                } else {
                    tdPrediction.textContent = '-';
                }
                tr.appendChild(tdPrediction);

                // Result
                const tdResult = document.createElement('td');
                if (prediction) {
                    const badge = document.createElement('span');
                    badge.className = `result-badge result-${prediction.result}`;
                    if (prediction.result === 'win') {
                        badge.textContent = '‚úì ‡¶ú‡¶Ø‡¶º';
                    } else if (prediction.result === 'loss') {
                        badge.textContent = '‚úó ‡¶π‡¶æ‡¶∞';
                    } else {
                        badge.textContent = '‚è≥ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡¶§';
                    }
                    tdResult.appendChild(badge);
                } else {
                    tdResult.textContent = '-';
                }
                tr.appendChild(tdResult);

                tbody.appendChild(tr);
            });
        }

        function getNumberColor(number) {
            const colors = numberProperties[number].colors;
            if (colors.includes('red')) return '#ff4757';
            if (colors.includes('green')) return '#2ed573';
            return '#667eea';
        }

        function getColorsForNumber(number) {
            return numberProperties[number].colors;
        }

        function updateStats() {
            document.getElementById('totalPredictions').textContent = stats.total;
            document.getElementById('totalWins').textContent = stats.wins;
            document.getElementById('totalLosses').textContent = stats.losses;
            
            const winRate = stats.total > 0 ? ((stats.wins / stats.total) * 100).toFixed(1) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
        }

        // Countdown timer
        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;

                // Update at 29 seconds
                if (countdown === 29) {
                    generatePrediction();
                    
                    // Save prediction
                    if (gameHistory.length > 0) {
                        const nextPeriod = String(Number(gameHistory[0].period) + 1);
                        predictions.push({
                            period: nextPeriod,
                            number: currentPrediction.number,
                            size: currentPrediction.size,
                            colors: currentPrediction.colors,
                            result: 'pending'
                        });
                    }
                }

                // Reset at 0
                if (countdown <= 0) {
                    countdown = 30;
                    fetchGameHistory();
                }
            }, 1000);
        }

        // Initialize
        async function init() {
            await fetchGameHistory();
            generatePrediction();
            startCountdown();
            
            // Fetch history every 30 seconds
            setInterval(fetchGameHistory, 30000);
        }

        init();
    </script>
</body>
</html>
